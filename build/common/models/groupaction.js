var async=require("async"),Promise=require("bluebird"),_=require("lodash");module.exports=function(a){a.saveAll=function(b,c,d){var e=[];_.forEach(c,function(a){e.push(a)}),async.auto({trans:function(b){a.beginTransaction({isolationLevel:a.Transaction.READ_COMMITTED},b)},"delete":["trans",function(c,d){a.dataSource.connector.execute("delete from groupaction where groupId=?",[b],{transaction:d.trans},c)}],insert:["trans","delete",function(b,c){a.create(e,b)}],commit:["insert",function(a,b){b.trans.commit(a)}]},function(a,b){a?b.trans?b.trans.rollback(function(){d(a)}):d(a):d(null,b.insert)})},a.remoteMethod("saveAll",{accepts:[{arg:"groupId",type:"number",required:!0},{arg:"datas",type:"object",http:{source:"body"}}],returns:{root:!0,type:"object"},http:{verb:"post",path:"/save/:groupId"}})};